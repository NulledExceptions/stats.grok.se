$def with (counts, page, proj, date, rank, render_time, form)

$ try:    
 	total = sum(counts.values())
$ except ValueError:
 	total = 'unknown times's
$ max_count = max(float(max(counts.values())), 1)
$ link = project_link(proj)

<!--  urllib.quote_plus(page) -->
<p><a href="http://$link/wiki/$page">$page</a> has been viewed $total

$if date.startswith('latest'):
     times in the last ${date[-2:]} days.
$else:
     times in $date.
     
$if rank > 0:
     This article ranked $rank in traffic on $link.



</p>

<div style="width:770px;text-align:right;font-size:0.8em ">
latest
<a href="/${proj}/latest30/$page">30</a>
<a href="/${proj}/latest60/$page">60</a>
<a href="/${proj}/latest90/$page">90</a>
days</div>
<div id="chartdiv" style="margin-left: 10px; height:400px;width:800px; "></div>

<form method="post" action="/">
$for input in form.inputs:
    $:input.render()
</form>

$ values = [[a.encode("ascii") + " 10 AM",b] for a,b in counts.items()]
$ days = [x[0] for x in values]
$ days.sort()
$ first_day = days[0].split()[0]


$if date.startswith('latest'):
    $ last_day = days[-1].split()[0]
$else:
    $ last_day = days[0][0:7]+"-31"


<script class="code" type="text/javascript">
$$(document).ready(function(){

  line1 = $:values;
  var plot1 = $$.jqplot ('chartdiv', [line1], {
      seriesColors: [ "#909AA9" ],
      // Give the plot a title.
      // You can specify options for all axes on the plot at once with
      // the axesDefaults object.  Here, we're using a canvas renderer
      // to draw the axis label which allows rotated text.
      axesDefaults: {
        labelRenderer: $$.jqplot.CanvasAxisLabelRenderer
      },
      seriesDefaults : {
          yaxis: 'y2axis',
          markerOptions: { style:"circle", size:8 },
          renderer:$$.jqplot.BarRenderer,
          rendererOptions: { barWidth: 10},

          trendline: {
            show: true
          }
      }, 
      // An axes object holds options for all axes.
      // Allowable axes are xaxis, x2axis, yaxis, y2axis, y3axis, ...
      // Up to 9 y axes are supported.
      axes: {
        // options for each axis are specified in seperate option objects.
        xaxis: {
          renderer:$$.jqplot.DateAxisRenderer,
          tickOptions:{formatString:'%Y-%m-%d'},
          label: "Date",
          min: '${first_day}',
          max: '${last_day} 14 PM',
        },
        y2axis: {
          label: "",
          min: 0,
          max: ${round_magnitude(max_count)}
        }
      }, 
      highlighter: {
        show: true
      },
      grid: {
        background: "#ffffff"
      }
  });

});

</script>


<div style="float: right">
<a class="FlattrButton" style="display:none;" rev="flattr" href="http://stats.grok.se"></a>
</div>

<p style="font-size: 0.6em"> <a href="/json/${proj}/$date/$page">This page in json format.</a> (took $render_time sec)</p>
